# PRD v0.5 — quizen (Web)
(반영: ① 난이도 1~5 사용자 선택 ② “PART.01 {파트 주제}” 규칙의 강의명 기반 자동 분류 기능 추가 ③ 템플릿(문항 개발 양식.xlsx) Export 매핑 유지)

---

## 0. 전제: 문항 개발 양식(템플릿) 구조(확정)
- 템플릿 시트(탭): `문항 개발 시트 복사하여 과정명 정확하게 입력바랍니다.`
- 헤더: 2행(A2~I2), 데이터 입력 시작: **3행**
- 컬럼(A~I)
  - A: 난이도(1~5)
  - B: 유형(1,2,3) — quizen은 **1(선다형), 3(OX형)**만 사용
  - C: 문항
  - D: 문제해설
  - E: 정답(유형별 입력 규칙)
  - F~I: 보기1~보기4(선다형 전용)

유형별 정답 규칙(템플릿 가이드)
- 유형=1(선다형): `1~4` (복수 정답 시 `"1,2"` 가능하나 MVP는 단일정답 기본)
- 유형=3(OX형): `1=O`, `2=X`

---

## 1. 제품 요약
- 제품명(가칭): **quizen**
- 한 줄 정의: 교육 운영 매니저가 Drive의 코스별 SRT 자막을 기반으로, 강의명을 PART 단위로 자동 분류하고(LLM), 문항(유형 1/3)을 자동 생성·검토·타당도 평가 후 **고정 템플릿 Google Sheets**로 배포하는 웹
- 모델: `models/gemini-3-flash-preview`
- UI 원칙: Web 1.0 스타일(단순 폼/표/로그, 최소 JS)

---

## 2. 목표(Goals) / 비목표(Non-goals)
### 2.1 Goals
1) 제작 시간 절감: `run_started` → `export_completed` 소요시간 감소
2) 사용자 만족도(리커트): 작업 완료 후 1문항 설문
3) 문항 신뢰도: **전문가 타당도(LLM 루브릭 기반 평가)** 점수/플래그 제공

### 2.2 Non-goals
- 로그인/계정/조직/권한 관리
- 협업 워크플로(승인/코멘트)
- 유형 2(단답형) 지원
- 응시/채점 플랫폼

---

## 3. 입력 데이터 규칙(Drive)
### 3.1 폴더 구조
- 상위: `강의 스크립트`
  - 하위 코스 폴더명: `{코스ID} {코스명}`
    - 내부: SRT 파일 다수(수십~수백)

### 3.2 SRT 파일명 규칙
- `{강의순번} {강의ID} {강의명}.srt`
  - 예: `001 918822 인간 박웅현이 바라본 일과 회사.srt`

### 3.3 정렬
- 강의순번 숫자 파싱 후 오름차순
- 파싱 실패 시 name 사전식 + “파싱 실패 파일 수” 경고 표시

---

## 4. 출제 기준(정책)
### 4.1 평가 목적
- 강의를 듣고 **개념 이해 여부** 확인

### 4.2 난이도
- **사용자 선택(1~5)**  
  - 기본값: `3(중)`
  - 템플릿 컬럼 A(난이도)는 사용자 선택값을 그대로 입력

### 4.3 문제 유형
- 유형 코드
  - `1`: 선다형(4지선다)
  - `3`: OX형(T/F)
- 정답 코드
  - 유형=1: `1~4` (MVP 기본: 단일정답)
  - 유형=3: `1=O`, `2=X`

---

## 5. 신규 기능: 강의명 기반 PART 자동 분류(LLM)
### 5.1 목적
- 코스 내 강의 수가 많을 때, 전처리/요약/출제를 **PART 단위로 구조화**하여
  - 전처리 품질(요약 일관성) 향상
  - 문항 커버리지(코스 전체 범위 분산) 향상
  - 검토 편의성(파트별 필터) 제공

### 5.2 입력 데이터(LLM에 제공)
- 코스 내 전체 강의 목록(파일명에서 파싱)
  - lecture_order (예: 001)
  - lecture_id (예: 918822)
  - lecture_title (예: 인간 박웅현이 바라본 일과 회사)
- LLM에는 **자막 내용이 아닌 “강의명 목록”만** 우선 전달하여 PART 분류 수행(비용/속도 최적화)

### 5.3 출력 규칙(강제)
- PART 명명 규칙(고정): **`PART.01 {파트 주제}`**
  - 번호는 2자리 0패딩(01, 02, 03…)
  - `{파트 주제}`는 한국어/영문 혼용 가능(단, 너무 포괄적 문구 금지)
- LLM 출력은 반드시 JSON 스키마를 만족해야 함

#### PART 분류 출력 스키마(v0.5)
- parts[]:
  - part_code: `"PART.01"` 형태
  - part_title: `{파트 주제}` (코드 제외)
  - part_name: `"PART.01 {파트 주제}"` (최종 표기)
  - lecture_ids[]: 해당 PART에 속하는 lecture_id 리스트(또는 lecture_order 기반 키)
- constraints:
  - 모든 강의가 정확히 1개 PART에 배정(누락/중복 금지)
  - PART 개수: 기본 4~10개 권장(코스 규모에 따라 LLM이 합리적으로 결정)

### 5.4 실패/대체 전략(과도한 엔지니어링 방지)
- LLM 호출 실패 또는 스키마 불만족 재시도 1회
- 그래도 실패 시 fallback(규칙 기반):
  - 강의순번 기준으로 균등 분할하여 PART 생성
  - 예: 120개 강의 → 6개 PART(각 20개)로 `PART.01~PART.06` 생성, 제목은 “코스 파트 1/2/…” 등 단순명

### 5.5 UI 요구사항(최소)
- Review 화면에 PART 필터/요약 표시
  - PART별 문항 개수, 평균 타당도 점수(선택)
- PART 편집은 MVP에서 “읽기 전용”을 기본으로 함(과도한 UI 방지)
  - (Should-have) PART명 수정/강의 재배치 UI는 v1 후순위

---

## 6. 전처리 정책(STT 자막 보정) — PART 기반으로 정렬
### 6.1 배경
- SRT는 STT 생성이라 부정확 표현이 존재 → LLM 전처리 필수

### 6.2 파이프라인(권장, MVP)
1) 코스 강의 목록 스캔 및 파싱
2) **PART 자동 분류(LLM)**
3) SRT 로딩 및 텍스트 추출(타임코드 제거)
4) 규칙 기반 정리(중복/잡음/개행 정리)
5) 요약 생성
   - 강의별 요약(선택: 비용/속도 따라 ON/OFF)
   - **PART별 요약 노트(필수 권장)**: 해당 PART의 강의 내용을 통합 요약
6) 문항 생성은 “PART 요약 노트”를 우선 근거로 사용(커버리지/정합성 확보)

---

## 7. 문체/서술 규칙(하드 제약)
- 문항/보기/해설 문체를 코스 내에서 통일
  - 선다형 문항(질문): “옳지 않은 것을 고르시오.” / “옳은 것을 고르시오.” / “기능을 고르시오.” 중 **1개 패턴 고정**
  - OX 문항(질문): “~한다.” 또는 “~이다.” 중 **1개 종결 고정**
  - 보기/해설: 정중체 통일(“~입니다/~합니다/~할 수 있습니다”)
- Review에서 문체 위반 가능 문항 자동 플래그(휴리스틱)

---

## 8. 핵심 사용자 플로우(v0.5)
1) 설정 입력(Drive 상위 폴더 ID, 코스 선택, Gemini Key, 서비스 계정 JSON)
2) 출제 옵션 입력
   - 난이도(1~5), 문항 수(5~50), 유형 포함(MCQ/OX)
3) 실행
   - 강의 목록 스캔 → **PART 분류(LLM)** → SRT 로딩 → 전처리/요약(PART 노트)
4) 문항 생성(PART 커버리지 고려)
5) 타당도 평가(루브릭 생성 → 문항 평가)
6) 검토/수정
7) Export(템플릿 복제 → A~I 매핑 입력) + 링크 제공
8) 만족도 설문

---

## 9. 기능 요구사항(Functional Requirements)

### 9.1 Setup 입력(필수)
- Drive 상위 폴더 ID(강의 스크립트)
- 코스 선택(폴더 목록)
- Gemini API Key
- Google 서비스 계정 Credential JSON 업로드
- 문항 수: 5~50
- 난이도: 1~5(기본 3)
- 유형: 선다형(1), OX(3) (둘 다 기본 ON)

### 9.2 문항 생성 내부 스키마(Export 최소필드)
- difficulty_code: 1~5 (사용자 선택)
- question_type_code: 1 또는 3
- question_text
- explanation_text
- answer_code(유형별 규칙)
- options(유형=1이면 4개)
- part_name(예: PART.01 데이터 전처리와 개요) — **내부 메타(Review 필터/커버리지용)**

### 9.3 PART 커버리지 규칙(권장, MVP)
- 문항을 PART에 분산 배치(극단적 쏠림 방지)
  - 예: 총 20문항, PART 5개 → 각 PART 최소 2문항 이상을 목표(부족 시 자동 조정)
- LLM 프롬프트에서 “PART별 핵심 개념을 골고루 반영”을 명시

### 9.4 타당도 평가(전문가 타당도 대리)
- 루브릭 생성(난이도/유형/목적 반영)
- 문항 평가 출력: total_score(0~100), issue_tags, 개선안
- UI: 저점수 플래그(<70 기본) + PART별 평균점수(선택)

### 9.5 Review(UI)
- 리스트
  - PART 필터, 유형 필터, 저점수/문체위반 필터, 텍스트 검색
- 편집
  - question_text, explanation_text, options, answer_code
  - 정답 입력은 템플릿 규칙 준수(유형=3은 O/X UI로 표시하되 저장은 1/2)

---

## 10. Export 요구사항(템플릿 고정) — v0.5 반영
### 10.1 템플릿 처리 방식
- 서버 설정: `TEMPLATE_SHEET_ID` 고정
- Export 시
  1) 템플릿 “사본 만들기”
  2) 문항 입력 탭을 코스명으로 설정(권장: `{코스ID} {코스명}`)
  3) 3행부터 데이터 입력(A~I)

### 10.2 quizen → 템플릿 컬럼 매핑(확정)
| 템플릿 컬럼 | 값 |
|---|---|
| A 난이도 | 사용자 선택값(1~5) |
| B 유형 | 선다형: 1 / OX형: 3 |
| C 문항 | question_text |
| D 문제해설 | explanation_text |
| E 정답 | 유형=1: "1"~"4" / 유형=3: "1"(O) 또는 "2"(X) |
| F 보기1 | 유형=1: option_1 / 유형=3: 공란 |
| G 보기2 | 유형=1: option_2 / 유형=3: 공란 |
| H 보기3 | 유형=1: option_3 / 유형=3: 공란 |
| I 보기4 | 유형=1: option_4 / 유형=3: 공란 |

### 10.3 Export 유효성 검사(필수)
- 난이도: 1~5 범위인지
- 유형: 1 또는 3인지
- 유형=1: 보기1~4 필수, 정답 1~4
- 유형=3: 정답 1 또는 2, 보기 공란 권장
- 템플릿 헤더 존재 여부(A2~I2)

### 10.4 (Should-have) PART 메타 탭 생성
- 템플릿에는 PART 컬럼이 없으므로, **추가 탭 `quizen_meta`**를 생성(가능하면)
  - PART 목록(part_code, part_title, 강의수, 강의ID 목록 요약)
  - 문항별 part_name, 출처(강의 파일명/스니펫) 저장
- 기본은 ON (다만 고객사 정책상 추가 탭이 문제라면 OFF 옵션 제공)

---

## 11. 이벤트 로깅 / KPI
- 추가 이벤트
  - part_classification_started / part_classification_completed (part_count)
  - part_classification_failed (fallback_used=true/false)
  - part_summary_completed (part_count, token_estimate)
- KPI 보강
  - PART 커버리지 지표: `questions_per_part` 분포, 쏠림도(예: max/min 비율)

---

## 12. 수용 기준(Acceptance Criteria) — v0.5
1) 사용자가 난이도 1~5를 선택하면, Export된 모든 문항의 템플릿 A열이 해당 값으로 채워진다.
2) 코스 강의명을 기반으로 LLM이 PART 분류를 생성하고, 모든 강의가 정확히 1개 PART에 배정된다.
3) PART 명명은 `PART.01 {파트 주제}` 규칙을 준수한다(번호 0패딩 포함).
4) 문항 생성은 PART 요약 노트를 우선 근거로 사용하며, 문항이 PART에 과도하게 쏠리지 않도록 분산된다(최소 분산 규칙 적용).
5) OX형 정답은 1(O)/2(X)로 Export된다.
6) 선다형은 보기 4개와 정답 1~4 규칙을 준수한다.
7) 템플릿 복제 후 3행부터 A~I에 정상 매핑되어 입력되고, 링크가 제공된다.

---

## 13. 오픈 이슈(구현 명세 착수 전 확정 권장)
- PART 분류 목표 파트 수(고정 vs LLM 자율 결정) 최종 정책 -> LLM 자율 결정
- 대용량 코스(>500 강의)에서 PART 분류 입력 길이 상한 및 2-pass 전략 적용 기준 -> 상한 없음.

---

## 14. 구현 명세 착수용 “결정된 인터페이스”(v0.5 기준)
(구현 시 변경 최소화를 위해, 아래 3개 산출물을 고정 계약으로 간주)

1) PART 분류 결과 JSON 스키마(§5.3)
2) 문항 Export 매핑(A~I) 및 정답/유형/난이도 검증 규칙(§10.2~10.3)
3) Review에서 필요한 내부 메타 필드: part_name, validity_score, style_violation_flags(§9.2~9.5)

---
